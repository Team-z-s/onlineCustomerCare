
create table users(
	id  integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	fname varchar(255) NOT NULL,
	lname varchar(255) NOT NULL,
	email varchar(255) NOT NULL UNIQUE,
	phone varchar(255) NOT NULL,
	username varchar(255) NOT NULL UNIQUE,
	password varchar(255) NOT NULL

);
create table roles(
	id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name varchar(255) NOT NULL UNIQUE

);
create table user_roles (
    user_id integer REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE,
    role_id integer REFERENCES roles(id) ON UPDATE CASCADE,
    CONSTRAINT user_role_pkey PRIMARY KEY (user_id, role_id)
);
create table comments (
     id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
     username varchar(255) REFERENCES users(username) ON UPDATE CASCADE ON DELETE CASCADE,
     message text NOT NULL,
     email varchar(255),
     posted_at timestamp NOT NULL
 );
create table company(
	id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	fullname varchar(255) NOT NULL ,
	logo varchar(255) NOT NULL,
	email varchar(255) NOT NULL UNIQUE,
	address varchar(255) NOT NULL,
	phone varchar(255) NOT NULL,
	moto text

);
create table company_roles(
	company_id integer REFERENCES company(id) ON UPDATE CASCADE ON DELETE CASCADE,
    role_id integer REFERENCES roles(id) ON UPDATE CASCADE,
    CONSTRAINT company_role_pkey PRIMARY KEY (company_id, role_id)
);


create table employee(
	id  integer GENERATED BY DEFAULT AS IDENTITY,
	company_id integer REFERENCES company(id) ON UPDATE CASCADE ON DELETE CASCADE,
	fname varchar(255) NOT NULL,
	lname varchar(255) NOT NULL,
	email varchar(255) NOT NULL UNIQUE,
	address varchar(255) NOT NULL,
	sallary double precision NOT NULL,
	phone varchar(255) NOT NULL,
	photo varchar(255),
	username varchar(255) NOT NULL UNIQUE,
	password varchar(255) NOT NULL
	CONSTRAINT employee_pkey PRIMARY KEY (employee_id, company_id)


);

create table employee_roles(
	employee_id integer REFERENCES employee(id) ON UPDATE CASCADE ON DELETE CASCADE,
    role_id integer REFERENCES roles(id) ON UPDATE CASCADE,
    CONSTRAINT employee_role_pkey PRIMARY KEY (employee_id, role_id)
);

create table service(
	id  integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	company_id integer REFERENCES company(id) ON UPDATE CASCADE ON DELETE CASCADE,
	service_name varchar(255) NOT NULL,
	description text NOT NULL

);

create table task(
	id  integer GENERATED BY DEFAULT AS IDENTITY,
	employee_id integer REFERENCES employee(id) ON UPDATE CASCADE ON DELETE CASCADE,
	task_name varchar(255) NOT NULL,
	description text NOT NULL,
	progress text ,
	CONSTRAINT task_pkey PRIMARY KEY (employee_id,id)


);
create table attendance(
	id  integer GENERATED BY DEFAULT AS IDENTITY,
	employee_id integer REFERENCES employee(id) ON UPDATE CASCADE ON DELETE CASCADE,
	shift varchar(64) NOT NULL,
	data_a date NOT NULL,
	status varchar(64) NOT NULL,
	posted_at timestamp NOT NULL,
	CONSTRAINT attendance_pkey PRIMARY KEY (employee_id,id)


);
create table employee_job(
	employee_id integer REFERENCES employee(id) ON UPDATE CASCADE ON DELETE CASCADE,
	company_id integer REFERENCES company(id) ON UPDATE CASCADE ON DELETE CASCADE,
	job varchar(255),
	day_rate double precision,
	night_rate double precision,
	CONSTRAINT employee_job_pkey PRIMARY KEY (employee_id,company_id)

);
